function createImage(e){var a=$(template);$(".imageHolder",a);var o=new FileReader;o.onload=function(){},o.readAsDataURL(e),message.hide(),a.appendTo(dropbox),$.data(e,a)}function showMessage(e){message.html(e)}function DeletePostImg(){var e="";e=$(".imageHolder").size()>0?$(".imageHolder").css("background-image"):$(".post_image_upload").css("background-image"),e=e.replace(/"/g,"").replace(/url\(|\)$/gi,""),h=e.split("/",6).join("/"),d=e.replace(h,"").replace("/",""),d=d.split("_")[0]+"_"+d.split("_")[1]+"_"+d.split("_")[2],$.ajax({url:"/share/image_upload",type:"DELETE",data:{img_name:d},dataType:"text",success:function(e){"s"==e&&($(".post_image_upload_wrap").attr("style",""),$(".input-mlarge").addClass("input-xxlarge").removeClass("input-mlarge"),$(".imageHolder").size()>0&&$(".preview").remove(),$(".post_image_upload").css({background:"#eaf5fa"}),$(".upload_btn, .message").show(),$(".del_post_img, .save_post_img_btn").hide(),$(".change_post_image_btn").css({"background-color":"#58AD69",color:"#fff"}).html('<i class="icon-pencil icon-white"></i> 更换图片'))},error:function(){alert("出错，可能是服务器那边出问题了，请联系管理员")}}),$("#post_Img_1").val("")}function JudgeCheck(){var e=$("input[name=sharetype]")[0].value;$("input[name=type][value="+e+"]").attr("checked",!0)}function CheckImg(){var e=$("input[name=post_img]")[0].value;if(e){var a="/static/upload/img/"+e;$(".post_image_upload").css({"background-size":"cover","background-image":'url(" '+a+' ")'}),$("#post_Img_1").val(""+e),$(".imageHolder").css({background:'url("'+a+' ") center center no-repeat',"background-size":"cover"}),$(".message, .upload_btn").hide(),$(".del_post_img, .save_post_img_btn").show()}}$.fn.toggleClick=function(){var e=arguments;return this.click(function(){var a=$(this).data("iteration")||0;e[a].apply(this,arguments),a=(a+1)%e.length,$(this).data("iteration",a)})},$("#switchImgWrap").toggleClick(function(){$(this).html("取消上传"),"none"==$(".post_image_upload_wrap").css("display")&&$(".post_image_upload_wrap").show()},function(){$(this).html("上传图片"),"block"==$(".post_image_upload_wrap").css("display")&&$(".post_image_upload_wrap").hide()});var dropbox=$(".post_image_upload"),message=$(".message",dropbox),template='<div class="preview"><span class="imageHolder"><span class="uploaded"></span></span><div class="progressHolder"><div class="progress"></div></div></div>';dropbox.filedrop({paramname:"uploadImg",allowedfiletypes:["image/jpeg","image/png","image/gif","image/bmp"],maxfiles:1,maxfilesize:2,url:"/share/image_upload",uploadFinished:function(e,a,o){"s"==o.status?(alert(o.info),$(".preview").remove(),$(".post_image_upload").css({background:"#EAF5FA"})):"o"==o.status?(alert(o.info),$(".preview").remove(),$(".post_image_upload").css({background:"#EAF5FA"})):"y"==o.status&&($("#post_Img_1").val(o.pic_1200),$(".imageHolder").css({background:'url(" static/upload/img/'+o.pic_1200+' ") center center no-repeat',"background-size":"cover"}),$(".post_image_upload").css({"background-size":"cover","background-image":'url(" static/upload/img/'+o.pic_1200+' ")'}),$.data(a).addClass("done"),uploaded=$(".uploaded",dropbox),$(uploaded).fadeIn(300),$(".upload_btn").hide(),$(".del_post_img, .save_post_img_btn").show(),setTimeout(function(){$(".uploaded, .progressHolder").fadeOut(250)},1e3))},error:function(e,a){switch(e){case"BrowserNotSupported":showMessage("你的浏览器不支持HTML5上传");break;case"TooManyFiles":alert("添加一张就可以了");break;case"FileTooLarge":alert(a.name+" 太大了，请上传不超过2M的")}},beforeEach:function(e){return e.type.match(/^image\//)?void 0:(alert("Only images are allowed!"),!1)},uploadStarted:function(e,a){createImage(a),$(".post_image_upload_1").css({background:"none"})},progressUpdated:function(e,a,o){$.data(a).find(".progress").width(o)}}),$("#upload_file_hide").change(function(){var e=new FormData;$.each($("#upload_file_hide")[0].files,function(a,o){e.append("uploadImg",o)}),$(".post_image_upload").css({background:"url(/static/img/onLoad.gif) center center no-repeat"}).find(".message").hide(),$.ajax({url:"/share/image_upload",type:"POST",data:e,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){"s"==e.status?(alert(e.info),$(".preview").remove(),$(".post_image_upload").css({background:"#EAF5FA"})):"o"==e.status?(alert(e.info),$(".preview").remove(),$(".post_image_upload").css({background:"#EAF5FA"})):"y"==e.status&&($("#post_Img_1").val(""+e.pic_1200),$(".post_image_upload").css({background:'url(" static/upload/img/'+e.pic_1200+' ") center center no-repeat',"background-size":"cover"}),$(".message, .upload_btn").hide(),$(".del_post_img").show())},error:function(){alert("请检查文件格式或者文件大小，目前只支持jpg/gif/jpeg/png/bmp格式的图片。不能超过2M"),$(".message").show(),$(".post_image_upload").css({background:"#EAF5FA"})}})}),$(".del_post_img").click(DeletePostImg),$(document).ready(function(){JudgeCheck(),CheckImg()});